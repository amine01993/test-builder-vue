const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/QuestionItem-k-gPf-5-.js","assets/index-D2vjYLyH.js","assets/index-PsUf1Fe-.css","assets/questionItem-CdtIUTuM.js","assets/testService-CGGkX3-W.js","assets/firestore-BC5DlS_a.js","assets/Question-DJVAB3JS.js","assets/utils-DltTuOhC.js","assets/QuestionItemD-BaVgzkfL.js"])))=>i.map(i=>d[i]);
import{d as se,u as ie,b as oe,v as ae,a as ne,r as v,x as le,o as de,c as ue,P as re,e as ce,f as V,w,L as me,y as ve,z as _e,g as a,h as t,m as h,t as i,i as e,j as d,F as _,k as x,p as g,A as S,B as C,C as L,l as k,I as O,q as U,_ as B,s as pe}from"./index-D2vjYLyH.js";import{d as M}from"./vuedraggable.umd-BY6zlOBI.js";import{u as fe,a as be}from"./testService-CGGkX3-W.js";import{_ as he}from"./AppContainer.vue_vue_type_script_setup_true_lang-CDo9AZgN.js";import"./firestore-BC5DlS_a.js";import"./Question-DJVAB3JS.js";const ye={class:"app-main"},ge={class:"test-form-title mb-4"},ke=["aria-label"],qe={key:0,class:"alert alert-danger",role:"alert"},Ee={class:"mb-3"},Te={for:"test-input-name",class:"form-label"},we=["disabled","tabindex"],Le={key:0,class:"invalid-feedback is-invalid"},Ve={class:"mb-3"},xe={for:"test-input-description",class:"form-label"},Se=["disabled","tabindex"],Ce={key:0,class:"invalid-feedback is-invalid"},Ne={class:"mb-3"},Pe={for:"test-input-timelimit",class:"form-label"},Ae=["data-bs-content","aria-label","tabindex"],De=["disabled","tabindex"],Fe={key:0,class:"invalid-feedback is-invalid"},Ie=["disabled","tabindex"],Qe={class:"question-actions"},Re={key:0,class:"question-info"},Oe={key:0,class:"placeholder-wave"},Ue={class:"question-info-label"},Be={key:1,class:"question-list"},Me={key:2,class:"question-list"},ze={scope:"col"},je={scope:"col"},$e={scope:"col"},Ge={scope:"col"},He={scope:"col"},Je={scope:"col"},Ke={scope:"col"},We={key:1},Xe=se({__name:"EditTestView",props:{test_id:{}},setup(q){const{t:s}=ie(),z=me(),N=ve(),{isDesktop:j,startLoading:$,endLoading:G,showMessage:p}=oe(),{spaceLabel:P}=ae(),{auth:H}=ne(),{test:f,loadTest:J,updateTest:K}=fe(),{questions:r,loadQuestions:W,updateQuestionsPositions:X}=be(),A=U(()=>B(()=>import("./QuestionItem-k-gPf-5-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),D=U(()=>B(()=>import("./QuestionItemD-BaVgzkfL.js"),__vite__mapDeps([8,1,2,3,4,5,6,7]))),y=v(""),E=v(""),b=v(0),u=v(z.query.sF!="0"),F=v(!1),m=v(!1),T=v([]),c=le(()=>{const n={};return F.value&&(y.value===""&&(n.name=s("Name required")),typeof b.value=="string"?n.timeLimit=s("The time limit must be a number"):b.value<0&&(n.timeLimit=s("The time limit can't be a negatif number"))),n}),Y=de(H,async()=>{u.value&&$();try{if(await J(q.test_id),!f.value){p("failure",s("Test Not Found."));return}y.value=f.value.name,E.value=f.value.description,b.value=f.value.time_limit}catch{p("failure",s("Error loading test data."))}finally{u.value&&G()}try{f.value&&await W(f.value)}catch(n){console.log("EditTestView",n),p("failure",s("Error loading questions."))}}),I=[];ue(()=>{document.querySelectorAll(".app-main .label-info").forEach(l=>{I.push(new re(l,{container:"body",placement:"right",html:!0,trigger:"click"}))})}),ce(()=>{I.forEach(n=>n.dispose()),Y()});async function Z(){if(!m.value){if(m.value=!0,F.value=!0,Object.keys(c.value).length>0){m.value=!1;return}try{await K(q.test_id,{name:y.value,description:E.value,time_limit:Number(b.value)}),T.value=[],p("success",s("Test edited with success.")),N.push({name:"tests"})}catch(n){T.value=[s("Server Error")+P.value+": "+n.code]}finally{m.value=!1}}}function ee(){u.value=!u.value,N.push({query:{sF:u.value?1:0}})}function Q(){q.test_id&&X(q.test_id).then(()=>{p("success",s("Positions updated with success."))}).catch(n=>{p("failure",s("Sorry! Positions can not be updated."))})}return(n,l)=>{const te=_e("RouterLink");return a(),V(he,null,{default:w(()=>{var R;return[t("div",ye,[t("div",{class:h(["test-form",{"hide-form":!u.value}])},[t("div",ge,i(e(s)("Edit Test")),1),t("button",{class:"btn toggle-form-btn",onClick:ee,"aria-label":u.value?e(s)("hide editing form"):e(s)("show editing form")},[t("i",{class:h(["bi",{"bi-chevron-down":!u.value,"bi-chevron-up":u.value}])},null,2)],8,ke),T.value.length?(a(),d("div",qe,[t("ul",null,[(a(!0),d(_,null,x(T.value,o=>(a(),d("li",{key:o},i(o),1))),128))])])):g("",!0),t("div",Ee,[t("label",Te,i(e(s)("Name")),1),S(t("input",{type:"text",class:h(["form-control",{"is-invalid":c.value.name}]),id:"test-input-name","onUpdate:modelValue":l[0]||(l[0]=o=>y.value=o),disabled:m.value,tabindex:u.value?void 0:-1,"aria-required":""},null,10,we),[[C,y.value]]),c.value.name?(a(),d("div",Le,i(c.value.name),1)):g("",!0)]),t("div",Ve,[t("label",xe,i(e(s)("Description")),1),S(t("textarea",{class:h(["form-control",{"is-invalid":c.value.description}]),id:"test-input-description","onUpdate:modelValue":l[1]||(l[1]=o=>E.value=o),rows:"3",disabled:m.value,tabindex:u.value?void 0:-1},null,10,Se),[[C,E.value]]),c.value.description?(a(),d("div",Ce,i(c.value.description),1)):g("",!0)]),t("div",Ne,[t("label",Pe,i(e(s)("Time Limit")),1),t("button",{class:"label-info","data-bs-content":e(s)("The test Time Limit is in seconds.<br>0 = no Time Limit"),"aria-label":e(s)("the test time limit input is in seconds. the value of 0 means no time limit"),tabindex:u.value?void 0:-1},l[5]||(l[5]=[t("i",{class:"bi bi-question-circle-fill"},null,-1)]),8,Ae),S(t("input",{type:"number",class:h(["form-control",{"is-invalid":c.value.timeLimit}]),id:"test-input-timelimit","onUpdate:modelValue":l[2]||(l[2]=o=>b.value=o),disabled:m.value,tabindex:u.value?void 0:-1},null,10,De),[[C,b.value]]),c.value.timeLimit?(a(),d("div",Fe,i(c.value.timeLimit),1)):g("",!0)]),t("button",{type:"button",class:"btn btn-primary",onClick:Z,disabled:m.value,tabindex:u.value?void 0:-1},[m.value?(a(),d(_,{key:1},[L(i(e(s)("Editing"))+" ...",1)],64)):(a(),d(_,{key:0},[L(i(e(s)("Edit")),1)],64))],8,Ie)],2)]),t("div",Qe,[k(te,{to:{name:"create-question",params:{test_id:n.test_id}},class:"btn btn-warning create-question"},{default:w(()=>[L(i(e(s)("Create New Question")),1)]),_:1},8,["to"])]),!e(r)||e(r).length>0?(a(),d("div",Re,[e(r)?(a(),d(_,{key:1},[t("span",Ue,i(e(s)("Total number of questions"))+i(e(P))+":",1),L(" "+i((R=e(r))==null?void 0:R.length),1)],64)):(a(),d("div",Oe,l[6]||(l[6]=[t("div",{class:"placeholder placeholder-lg col-8 bg-secondary"},null,-1)])))])):g("",!0),e(j)?(a(),d("div",Me,[t("table",{class:h(["table",{loading:!e(r)}])},[t("thead",null,[t("tr",null,[l[7]||(l[7]=t("th",{scope:"col"},null,-1)),t("th",ze,i(e(s)("Question")),1),t("th",je,i(e(s)("Max Points")),1),t("th",$e,i(e(s)("Type")),1),t("th",Ge,i(e(s)("Position")),1),t("th",He,i(e(s)("Nbr of Choices")),1),t("th",Je,i(e(s)("Last updated at")),1),t("th",Ke,i(e(s)("Actions")),1)])]),e(r)?(a(),V(e(M),{key:0,modelValue:e(r),"onUpdate:modelValue":l[4]||(l[4]=o=>O(r)?r.value=o:null),"item-key":"id",tag:"tbody",handle:".question-item-sort-handler",onEnd:Q},{item:w(({element:o})=>[k(e(D),{test_id:n.test_id,question:o},null,8,["test_id","question"])]),_:1},8,["modelValue"])):(a(),d("tbody",We,[(a(),d(_,null,x(5,o=>k(e(D),{key:"question-placeholder-"+o})),64))]))],2)])):(a(),d(_,{key:1},[e(r)?(a(),V(e(M),{key:0,modelValue:e(r),"onUpdate:modelValue":l[3]||(l[3]=o=>O(r)?r.value=o:null),"item-key":"id",tag:"div","component-data":{class:"question-list"},handle:".question-item-sort-handler",onEnd:Q},{item:w(({element:o})=>[k(e(A),{test_id:n.test_id,question:o},null,8,["test_id","question"])]),_:1},8,["modelValue"])):(a(),d("div",Be,[(a(),d(_,null,x([0,1,2],o=>k(e(A),{key:"question-placeholder-"+o})),64))]))],64))]}),_:1})}}}),ot=pe(Xe,[["__scopeId","data-v-efec160f"]]);export{ot as default};
