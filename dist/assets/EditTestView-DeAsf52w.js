import{g as J,B as ee,c as M,d as U,_ as R,v as j,o as n,a as r,F as f,b as i,t as a,e as p,p as b,w as _,f as te,n as v,D as ie,q as se,u as oe,r as q,h as ne,i as re,P as le,j as ae,l as F,m as I,x as N,y as O,z as D}from"./index-CGS4B7OT.js";import{d as de}from"./vuedraggable.umd-BCWnW8aA.js";import{a as K,u as ue}from"./testService-DeBIOd3R.js";import{A as ce}from"./AppContainer-BbQHt-u2.js";import{Q as P}from"./Question-DJVAB3JS.js";import"./firestore-B39V3hTY.js";function W(d,e){const{showMessage:s,startLoading:t,endLoading:m}=J(),{deleteQuestion:u}=K(),{confirm:c}=ee(),o=new Date,w=M(()=>{switch(e==null?void 0:e.type){case P.MultipleChoice:return"Multiple Choice";case P.Number:return"Number";case P.SingleChoice:return"Single Choice";default:return"Text"}}),T=M(()=>{const h=e.updated_at.toDate();return new Intl.DateTimeFormat("en-US",{day:"numeric",month:"short",year:o.getFullYear()===h.getFullYear()?void 0:"numeric",hour:"numeric",minute:"numeric"}).format(h)});function Q(){e&&c(`Are you sure you want to delete this question: "${e.text}"?`,"Delete",S)}async function S(){if(d&&(e!=null&&e.id))try{t(),await u(d,e.id),s("success","Question deleted with success.")}catch{s("failure","Question can not be deleted.")}finally{m()}}return{questionType:w,updatedAt:T,confirmQuestiondeletion:Q}}const me=U({__name:"QuestionItem",props:{test_id:{type:String,required:!1},question:{type:Object,required:!1}},setup(d,{expose:e}){e();const{questionType:s,updatedAt:t,confirmQuestiondeletion:m}=W(d.test_id,d.question),u={questionType:s,updatedAt:t,confirmQuestiondeletion:m};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}}),fe={class:"question-item-content"},be={class:"question-item-title"},ve={class:"question-item-info"},_e={class:"question-property"},qe={class:"question-property"},ye={class:"question-property"},pe={key:0,class:"question-property"},he={class:"question-last-update"},ge={class:"question-item-actions"},ke={key:1,class:"question-item-content"};function we(d,e,s,t,m,u){const c=j("RouterLink");return n(),r("div",{class:v(["question-item-container",{"placeholder-wave":!s.question}])},[s.question?(n(),r(f,{key:0},[e[6]||(e[6]=i("div",{class:"question-item-sort-handler"},[i("i",{class:"bi bi-arrow-down-up"})],-1)),i("div",fe,[i("div",be,a(s.question.text),1),e[4]||(e[4]=i("hr",{class:"question-item-divider"},null,-1)),i("div",ve,[i("div",_e,"Max Points: "+a(s.question.max_points),1),i("div",qe,"Type: "+a(t.questionType),1),i("div",ye,"Position: "+a(s.question.position),1),s.question.choiceCount?(n(),r("div",pe,"Total number of choices: "+a(s.question.choiceCount),1)):p("",!0),i("div",he,"Last updated at: "+a(t.updatedAt),1)]),e[5]||(e[5]=i("hr",{class:"question-item-divider"},null,-1)),i("div",ge,[b(c,{to:{name:"preview-question",params:{test_id:s.test_id,question_id:s.question.id}},class:"btn btn-primary"},{default:_(()=>e[1]||(e[1]=[i("i",{class:"bi bi-eye-fill"},null,-1)])),_:1},8,["to"]),b(c,{to:{name:"edit-question",params:{test_id:s.test_id,question_id:s.question.id}},class:"btn btn-success"},{default:_(()=>e[2]||(e[2]=[i("i",{class:"bi bi-pencil-fill"},null,-1)])),_:1},8,["to"]),i("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...o)=>t.confirmQuestiondeletion&&t.confirmQuestiondeletion(...o))},e[3]||(e[3]=[i("i",{class:"bi bi-trash3-fill"},null,-1)]))])])],64)):(n(),r("div",ke,e[7]||(e[7]=[te('<div class="question-item-title placeholder col-6 offset-3 placeholder-lg bg-secondary"></div><hr class="question-item-divider"><div class="question-item-info"><div class="placeholder col-12 bg-secondary" style="min-height:4em;"></div><div class="placeholder col-8 offset-4 placeholder-sm bg-secondary"></div></div><hr class="question-item-divider"><div class="question-item-actions placeholder col-9 offset-3 placeholder-lg bg-secondary"></div>',5)])))],2)}const Te=R(me,[["render",we],["__file","C:/Users/erram/OneDrive/Documents/test-builder-vue/src/components/items/QuestionItem.vue"]]),Qe=U({__name:"QuestionItemD",props:{test_id:{type:String,required:!1},question:{type:Object,required:!1}},setup(d,{expose:e}){e();const{questionType:s,updatedAt:t,confirmQuestiondeletion:m}=W(d.test_id,d.question),u={questionType:s,updatedAt:t,confirmQuestiondeletion:m};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}}),Ce={class:"question-property"},De={class:"question-property"},Se={class:"question-property"},Ee={class:"question-property"},Le={class:"question-last-update"},xe={class:"question-item-actions-container"},Ve={class:"question-item-actions"},Ae={key:1,colspan:"8",class:"placeholder bg-secondary"};function Fe(d,e,s,t,m,u){const c=j("RouterLink");return n(),r("tr",{class:v(["question-item-container",{"placeholder-wave":!s.question}])},[s.question?(n(),r(f,{key:0},[e[4]||(e[4]=i("td",{class:"question-item-sort-handler-container"},[i("div",{class:"question-item-sort-handler"},[i("i",{class:"bi bi-arrow-down-up"})])],-1)),i("th",null,a(s.question.text),1),i("td",Ce,a(s.question.max_points),1),i("td",De,a(t.questionType),1),i("td",Se,a(s.question.position),1),i("td",Ee,a(s.question.choiceCount),1),i("td",Le,a(t.updatedAt),1),i("td",xe,[i("div",Ve,[b(c,{to:{name:"preview-question",params:{test_id:s.test_id,question_id:s.question.id}},class:"btn btn-primary"},{default:_(()=>e[1]||(e[1]=[i("i",{class:"bi bi-eye-fill"},null,-1)])),_:1},8,["to"]),b(c,{to:{name:"edit-question",params:{test_id:s.test_id,question_id:s.question.id}},class:"btn btn-success"},{default:_(()=>e[2]||(e[2]=[i("i",{class:"bi bi-pencil-fill"},null,-1)])),_:1},8,["to"]),i("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...o)=>t.confirmQuestiondeletion&&t.confirmQuestiondeletion(...o))},e[3]||(e[3]=[i("i",{class:"bi bi-trash3-fill"},null,-1)]))])])],64)):(n(),r("td",Ae))],2)}const Ie=R(Qe,[["render",Fe],["__file","C:/Users/erram/OneDrive/Documents/test-builder-vue/src/components/items/QuestionItemD.vue"]]),Ne=U({__name:"EditTestView",props:{test_id:{type:String,required:!0}},setup(d,{expose:e}){e();const s=ie(),t=se(),{isDesktop:m,startLoading:u,endLoading:c,showMessage:o}=J(),{auth:w}=oe(),{getTest:T,updateTest:Q}=ue(),{questionCount:S,questions:h,loadQuestions:B,updateQuestionsPositions:z}=K(),C=q(""),E=q(""),g=q(0),y=q(s.query.sF!="0"),L=q(!1),k=q(!1),x=q([]),Y=M(()=>{const l={};return L.value&&(C.value===""&&(l.name="Name required"),typeof g.value=="string"?l.timeLimit="The time limit must be a number":g.value<0&&(l.timeLimit="The time limit can't be a negatif number")),l}),G=ne(w,async()=>{y.value&&u();let l;try{if(l=await T(d.test_id),!l){o("failure","Test Not Found.");return}C.value=l.name,E.value=l.description,g.value=l.time_limit}catch{o("failure","Error loading test data.")}finally{y.value&&c()}try{l&&await B(l)}catch{o("failure","Error loading questions.")}}),V=[];re(()=>{document.querySelectorAll(".app-main .label-info").forEach(A=>{V.push(new le(A,{container:"body",placement:"right",html:!0,trigger:"click"}))})}),ae(()=>{V.forEach(l=>l.dispose()),G()});async function X(){if(!k.value){if(k.value=!0,L.value=!0,Object.keys(Y.value).length>0){k.value=!1;return}try{await Q(d.test_id,{name:C.value,description:E.value,time_limit:Number(g.value)}),x.value=[],t.push({name:"tests"})}catch(l){x.value=["Server Error: "+l.code]}finally{k.value=!1}}}function Z(){y.value=!y.value,t.push({query:{sF:y.value?1:0}})}function $(){d.test_id&&z(d.test_id).then(()=>{o("success","Positions updated with success.")}).catch(l=>{o("failure","Sorry! Positions can not be updated.")})}const H={route:s,router:t,isDesktop:m,startLoading:u,endLoading:c,showMessage:o,auth:w,getTest:T,updateTest:Q,questionCount:S,questions:h,loadQuestions:B,updateQuestionsPositions:z,name:C,description:E,timeLimit:g,showForm:y,submitted:L,submitting:k,serverErrors:x,errors:Y,onAuthEventDispose:G,popOvers:V,editTest:X,toggleShowForm:Z,onDragEnd:$,get draggable(){return de},AppContainer:ce,QuestionItem:Te,QuestionItemD:Ie};return Object.defineProperty(H,"__isScriptSetup",{enumerable:!1,value:!0}),H}}),Oe={class:"app-main"},Pe={key:0,class:"alert alert-danger",role:"alert"},Me={class:"mb-3"},Ue=["disabled"],Re={key:0,class:"invalid-feedback is-invalid"},je={class:"mb-3"},Be=["disabled"],ze={key:0,class:"invalid-feedback is-invalid"},Ye={class:"mb-3"},Ge=["disabled"],He={key:0,class:"invalid-feedback is-invalid"},Je=["disabled"],Ke={class:"question-actions"},We={key:0,class:"question-info"},Xe={key:1,class:"placeholder-wave"},Ze={key:1,class:"question-list"},$e={key:2,class:"question-list"},et={key:1};function tt(d,e,s,t,m,u){const c=j("RouterLink");return n(),F(t.AppContainer,null,{default:_(()=>[i("div",Oe,[i("div",{class:v(["test-form",{"hide-form":!t.showForm}])},[e[9]||(e[9]=i("div",{class:"test-form-title mb-4"},"Edit Test",-1)),i("button",{class:"btn toggle-form-btn",onClick:t.toggleShowForm},[i("i",{class:v(["bi",{"bi-chevron-down":!t.showForm,"bi-chevron-up":t.showForm}])},null,2)]),t.serverErrors.length?(n(),r("div",Pe,[i("ul",null,[(n(!0),r(f,null,I(t.serverErrors,o=>(n(),r("li",{key:o},a(o),1))),128))])])):p("",!0),i("div",Me,[e[5]||(e[5]=i("label",{for:"test-input-name",class:"form-label"},"Name",-1)),N(i("input",{type:"text",class:v(["form-control",{"is-invalid":t.errors.name}]),id:"test-input-name","onUpdate:modelValue":e[0]||(e[0]=o=>t.name=o),disabled:t.submitting},null,10,Ue),[[O,t.name]]),t.errors.name?(n(),r("div",Re,a(t.errors.name),1)):p("",!0)]),i("div",je,[e[6]||(e[6]=i("label",{for:"test-input-description",class:"form-label"},"Description",-1)),N(i("textarea",{class:v(["form-control",{"is-invalid":t.errors.description}]),id:"test-input-description","onUpdate:modelValue":e[1]||(e[1]=o=>t.description=o),rows:"3",disabled:t.submitting},null,10,Be),[[O,t.description]]),t.errors.description?(n(),r("div",ze,a(t.errors.description),1)):p("",!0)]),i("div",Ye,[e[7]||(e[7]=i("label",{for:"test-input-timelimit",class:"form-label"},"Time limit",-1)),e[8]||(e[8]=i("span",{class:"label-info","data-bs-content":"The test Time Limit is in seconds.<br>0 = no Time Limit"},[i("i",{class:"bi bi-question-circle-fill"})],-1)),N(i("input",{type:"number",class:v(["form-control",{"is-invalid":t.errors.timeLimit}]),id:"test-input-timelimit","onUpdate:modelValue":e[2]||(e[2]=o=>t.timeLimit=o),disabled:t.submitting},null,10,Ge),[[O,t.timeLimit]]),t.errors.timeLimit?(n(),r("div",He,a(t.errors.timeLimit),1)):p("",!0)]),i("button",{type:"button",class:"btn btn-primary",onClick:t.editTest,disabled:t.submitting},[t.submitting?(n(),r(f,{key:1},[D("Editing ...")],64)):(n(),r(f,{key:0},[D("Edit")],64))],8,Je)],2)]),i("div",Ke,[b(c,{to:{name:"create-question",params:{test_id:s.test_id}},class:"btn btn-warning create-question"},{default:_(()=>e[10]||(e[10]=[D("Create New Question")])),_:1},8,["to"])]),t.questionCount!==0?(n(),r("div",We,[t.questionCount?(n(),r(f,{key:0},[e[11]||(e[11]=i("span",{class:"question-info-label"},"Total number of questions:",-1)),D(" "+a(t.questionCount),1)],64)):(n(),r("div",Xe,e[12]||(e[12]=[i("div",{class:"placeholder placeholder-lg col-8 bg-secondary"},null,-1)])))])):p("",!0),t.isDesktop?(n(),r("div",$e,[i("table",{class:v(["table",{loading:!t.questions}])},[e[13]||(e[13]=i("thead",null,[i("tr",null,[i("th",{scope:"col"}),i("th",{scope:"col"},"Question"),i("th",{scope:"col"},"Max Points"),i("th",{scope:"col"},"Type"),i("th",{scope:"col"},"Position"),i("th",{scope:"col"},"Nbr of Choices"),i("th",{scope:"col"},"Last updated at"),i("th",{scope:"col"},"Actions")])],-1)),t.questions?(n(),F(t.draggable,{key:0,modelValue:t.questions,"onUpdate:modelValue":e[4]||(e[4]=o=>t.questions=o),"item-key":"id",tag:"tbody",handle:".question-item-sort-handler",onEnd:t.onDragEnd},{item:_(({element:o})=>[b(t.QuestionItemD,{test_id:s.test_id,question:o},null,8,["test_id","question"])]),_:1},8,["modelValue"])):(n(),r("tbody",et,[(n(),r(f,null,I(5,o=>b(t.QuestionItemD,{key:"question-placeholder-"+o})),64))]))],2)])):(n(),r(f,{key:1},[t.questions?(n(),F(t.draggable,{key:0,modelValue:t.questions,"onUpdate:modelValue":e[3]||(e[3]=o=>t.questions=o),"item-key":"id",tag:"div","component-data":{class:"question-list"},handle:".question-item-sort-handler",onEnd:t.onDragEnd},{item:_(({element:o})=>[b(t.QuestionItem,{test_id:s.test_id,question:o},null,8,["test_id","question"])]),_:1},8,["modelValue"])):(n(),r("div",Ze,[(n(),r(f,null,I([0,1,2],o=>b(t.QuestionItem,{key:"question-placeholder-"+o})),64))]))],64))]),_:1})}const at=R(Ne,[["render",tt],["__scopeId","data-v-a0982f31"],["__file","C:/Users/erram/OneDrive/Documents/test-builder-vue/src/views/EditTestView.vue"]]);export{at as default};
