const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/QuestionItem-BKDflFby.js","assets/index-CYSG3gem.js","assets/index-Comk1Z5G.css","assets/questionItem-Chjf5KVe.js","assets/testService-Cnbo4ErZ.js","assets/firestore-PMUsJiSA.js","assets/Question-DJVAB3JS.js","assets/utils-DltTuOhC.js","assets/QuestionItemD-o7IrU4aV.js"])))=>i.map(i=>d[i]);
import{d as se,u as ie,b as oe,v as ae,a as ne,r as v,x as le,o as de,c as ue,P as re,e as ce,f as V,w as L,L as me,y as ve,z as pe,g as n,h as t,m as h,t as i,i as e,j as d,F as p,k as x,p as g,C as k,A as S,B as C,l as q,I as O,q as U,_ as B,s as _e}from"./index-CYSG3gem.js";import{d as M}from"./vuedraggable.umd-BpaRITxi.js";import{u as be,a as fe}from"./testService-Cnbo4ErZ.js";import{_ as he}from"./AppContainer.vue_vue_type_script_setup_true_lang-6SrFR88_.js";import"./firestore-PMUsJiSA.js";import"./Question-DJVAB3JS.js";const ye={class:"app-main"},ge={class:"test-form-title mb-4"},ke=["aria-label"],qe={key:0,class:"alert alert-danger",role:"alert"},Ee={class:"mb-3"},Te={for:"test-input-name",class:"form-label"},we=["disabled","tabindex"],Le={key:0,class:"invalid-feedback is-invalid"},Ve={class:"mb-3"},xe={for:"test-input-description",class:"form-label"},Se=["disabled","tabindex"],Ce={key:0,class:"invalid-feedback is-invalid"},Ne={class:"mb-3"},Pe={for:"test-input-timelimit",class:"form-label"},Ae=["data-bs-content","aria-label","tabindex"],De=["disabled","tabindex"],Fe={key:0,class:"invalid-feedback is-invalid"},Ie=["disabled","tabindex"],Qe={class:"question-actions"},Re={key:0,class:"question-info"},Oe={key:0,class:"placeholder-wave"},Ue={class:"question-info-label"},Be={key:1,class:"question-list"},Me={key:2,class:"question-list"},ze={scope:"col"},je={scope:"col"},$e={scope:"col"},Ge={scope:"col"},He={scope:"col"},Je={scope:"col"},Ke={scope:"col"},We={key:1},Xe=se({__name:"EditTestView",props:{test_id:{}},setup(E){const{t:s}=ie(),z=me(),N=ve(),{isDesktop:j,startLoading:$,endLoading:G,showMessage:_}=oe(),{spaceLabel:P}=ae(),{auth:H}=ne(),{test:b,loadTest:J,updateTest:K}=be(),{questions:r,loadQuestions:W,updateQuestionsPositions:X}=fe(),A=U(()=>B(()=>import("./QuestionItem-BKDflFby.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),D=U(()=>B(()=>import("./QuestionItemD-o7IrU4aV.js"),__vite__mapDeps([8,1,2,3,4,5,6,7]))),y=v(""),T=v(""),f=v(0),u=v(z.query.sF!="0"),F=v(!1),m=v(!1),w=v([]),c=le(()=>{const l={};return F.value&&(y.value===""&&(l.name=s("Name required")),typeof f.value=="string"?l.timeLimit=s("The time limit must be a number"):f.value<0&&(l.timeLimit=s("The time limit can't be a negatif number"))),l}),Y=de(H,async()=>{u.value&&$();try{if(await J(E.test_id),!b.value){_("failure",s("Test Not Found."));return}y.value=b.value.name,T.value=b.value.description,f.value=b.value.time_limit}catch{_("failure",s("Error loading test data."))}finally{u.value&&G()}try{b.value&&await W(b.value)}catch(l){console.log("EditTestView",l),_("failure",s("Error loading questions."))}}),I=[];ue(()=>{document.querySelectorAll(".app-main .label-info").forEach(o=>{I.push(new re(o,{container:"body",placement:"right",html:!0,trigger:"click"}))})}),ce(()=>{I.forEach(l=>l.dispose()),Y()});async function Z(){if(!m.value){if(m.value=!0,F.value=!0,Object.keys(c.value).length>0){m.value=!1;return}try{await K(E.test_id,{name:y.value,description:T.value,time_limit:Number(f.value)}),w.value=[],_("success",s("Test edited with success.")),N.push({name:"tests"})}catch(l){w.value=[s("Server Error")+P.value+": "+l.code]}finally{m.value=!1}}}function ee(){u.value=!u.value,N.push({query:{sF:u.value?1:0}})}function Q(){E.test_id&&X(E.test_id).then(()=>{_("success",s("Positions updated with success."))}).catch(l=>{_("failure",s("Sorry! Positions can not be updated."))})}return(l,o)=>{const te=pe("RouterLink");return n(),V(he,null,{default:L(()=>{var R;return[t("div",ye,[t("div",{class:h(["test-form",{"hide-form":!u.value}])},[t("div",ge,i(e(s)("Edit Test")),1),t("button",{class:"btn toggle-form-btn",onClick:ee,"aria-label":u.value?e(s)("hide editing form"):e(s)("show editing form")},[t("i",{class:h(["bi",{"bi-chevron-down":!u.value,"bi-chevron-up":u.value}])},null,2)],8,ke),w.value.length?(n(),d("div",qe,[t("ul",null,[(n(!0),d(p,null,x(w.value,a=>(n(),d("li",{key:a},i(a),1))),128))])])):g("",!0),t("div",Ee,[t("label",Te,[k(i(e(s)("Name")),1),o[5]||(o[5]=t("span",{class:"required"},"*",-1))]),S(t("input",{type:"text",class:h(["form-control",{"is-invalid":c.value.name}]),id:"test-input-name","onUpdate:modelValue":o[0]||(o[0]=a=>y.value=a),disabled:m.value,tabindex:u.value?void 0:-1,"aria-required":""},null,10,we),[[C,y.value]]),c.value.name?(n(),d("div",Le,i(c.value.name),1)):g("",!0)]),t("div",Ve,[t("label",xe,i(e(s)("Description")),1),S(t("textarea",{class:h(["form-control",{"is-invalid":c.value.description}]),id:"test-input-description","onUpdate:modelValue":o[1]||(o[1]=a=>T.value=a),rows:"3",disabled:m.value,tabindex:u.value?void 0:-1},null,10,Se),[[C,T.value]]),c.value.description?(n(),d("div",Ce,i(c.value.description),1)):g("",!0)]),t("div",Ne,[t("label",Pe,i(e(s)("Time Limit")),1),t("button",{class:"label-info","data-bs-content":e(s)("The test Time Limit is in seconds.<br>0 = no Time Limit"),"aria-label":e(s)("the test time limit input is in seconds. the value of 0 means no time limit"),tabindex:u.value?void 0:-1},o[6]||(o[6]=[t("i",{class:"bi bi-question-circle-fill"},null,-1)]),8,Ae),S(t("input",{type:"number",class:h(["form-control",{"is-invalid":c.value.timeLimit}]),id:"test-input-timelimit","onUpdate:modelValue":o[2]||(o[2]=a=>f.value=a),disabled:m.value,tabindex:u.value?void 0:-1},null,10,De),[[C,f.value]]),c.value.timeLimit?(n(),d("div",Fe,i(c.value.timeLimit),1)):g("",!0)]),t("button",{type:"button",class:"btn btn-primary",onClick:Z,disabled:m.value,tabindex:u.value?void 0:-1},[m.value?(n(),d(p,{key:1},[k(i(e(s)("Editing"))+" ...",1)],64)):(n(),d(p,{key:0},[k(i(e(s)("Edit")),1)],64))],8,Ie)],2)]),t("div",Qe,[q(te,{to:{name:"create-question",params:{test_id:l.test_id}},class:"btn btn-warning create-question"},{default:L(()=>[k(i(e(s)("Create New Question")),1)]),_:1},8,["to"])]),!e(r)||e(r).length>0?(n(),d("div",Re,[e(r)?(n(),d(p,{key:1},[t("span",Ue,i(e(s)("Total number of questions"))+i(e(P))+":",1),k(" "+i((R=e(r))==null?void 0:R.length),1)],64)):(n(),d("div",Oe,o[7]||(o[7]=[t("div",{class:"placeholder placeholder-lg col-8 bg-secondary"},null,-1)])))])):g("",!0),e(j)?(n(),d("div",Me,[t("table",{class:h(["table",{loading:!e(r)}])},[t("thead",null,[t("tr",null,[o[8]||(o[8]=t("th",{scope:"col"},null,-1)),t("th",ze,i(e(s)("Question")),1),t("th",je,i(e(s)("Max Points")),1),t("th",$e,i(e(s)("Type")),1),t("th",Ge,i(e(s)("Position")),1),t("th",He,i(e(s)("Nbr of Choices")),1),t("th",Je,i(e(s)("Last updated at")),1),t("th",Ke,i(e(s)("Actions")),1)])]),e(r)?(n(),V(e(M),{key:0,modelValue:e(r),"onUpdate:modelValue":o[4]||(o[4]=a=>O(r)?r.value=a:null),"item-key":"id",tag:"tbody",handle:".question-item-sort-handler",onEnd:Q},{item:L(({element:a})=>[q(e(D),{test_id:l.test_id,question:a},null,8,["test_id","question"])]),_:1},8,["modelValue"])):(n(),d("tbody",We,[(n(),d(p,null,x(5,a=>q(e(D),{key:"question-placeholder-"+a})),64))]))],2)])):(n(),d(p,{key:1},[e(r)?(n(),V(e(M),{key:0,modelValue:e(r),"onUpdate:modelValue":o[3]||(o[3]=a=>O(r)?r.value=a:null),"item-key":"id",tag:"div","component-data":{class:"question-list"},handle:".question-item-sort-handler",onEnd:Q},{item:L(({element:a})=>[q(e(A),{test_id:l.test_id,question:a},null,8,["test_id","question"])]),_:1},8,["modelValue"])):(n(),d("div",Be,[(n(),d(p,null,x([0,1,2],a=>q(e(A),{key:"question-placeholder-"+a})),64))]))],64))]}),_:1})}}}),ot=_e(Xe,[["__scopeId","data-v-a7189365"]]);export{ot as default};
