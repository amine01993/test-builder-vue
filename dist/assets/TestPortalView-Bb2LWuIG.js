import{d as Q,u as W,b as X,K as Z,a as ee,L as te,r as E,x as y,o as se,e as ae,j as o,i as t,h as s,t as r,A as F,B as L,m as C,I as D,p as f,F as _,C as T,k as ie,y as ne,n as oe,g as i,f as le,s as re}from"./index-hcXieGcP.js";import{u as ue}from"./userTestService-CzSsYdVi.js";import{v as de,f as ce}from"./utils-DltTuOhC.js";import{_ as me}from"./DisplayQuestion.vue_vue_type_script_setup_true_lang-Cm-YcwjL.js";import"./firestore-t582GyIa.js";import"./Question-DJVAB3JS.js";const fe={key:0,class:"user-info-form"},pe={class:"mb-3"},ve={for:"full-name-input",class:"form-label"},be=["disabled"],_e={key:0,class:"invalid-feedback is-invalid"},he={class:"mb-3"},ye={for:"email-input",class:"form-label"},Te=["disabled"],we={key:0,class:"invalid-feedback is-invalid"},ke=["disabled"],ge={key:1,class:"app-test-header"},Ne={class:"test-name"},Se={key:0,class:"test-limit"},xe={key:2,class:"app-test-description"},Ee=["innerHTML"],Fe={class:"test-points"},Le={key:3,class:"app-main"},Ce={ref:"test-form"},De={class:"app-test-actions"},Ie=["aria-label"],Ve=Q({__name:"TestPortalView",props:{test_id:{}},setup(I){const V=ne(),{t:a}=W(),{startLoading:M,endLoading:R,showMessage:w}=X(),{confirm:U}=Z(),{auth:A}=ee(),{test:l,time_limit:k,displayName:p,email:d,requestUserInfo:g,updateUserInfo:B,initTest:q,sendReport:j,setTestReport:z}=ue(),v=te("test-form"),h=E(!1),u=E(!1),c=y(()=>{const e={};return h.value&&(p.value===""&&(e.displayName=a("Full Name required")),d.value===""?e.email=a("Email required"):de(d.value)||(e.email=a("Invalid email"))),e});let b;const H=y(()=>{const e=ce(k.value);return e===""?a("Time out"):e}),P=y(()=>{var e;return(e=l.value)!=null&&e.description?l.value.description.replace(/\n/g,"<br />"):""}),K=se(A,async e=>{e&&(e.displayName&&(p.value=e.displayName),e.email&&(d.value=e.email),(p.value&&d.value||!g.value)&&await N())});ae(()=>{K(),b!==void 0&&(clearInterval(b),b=void 0),v.value&&v.value.removeEventListener("submit",S),window.onbeforeunload=null});async function O(){if(h.value=!0,!u.value){if(u.value=!0,Object.keys(c.value).length>0){u.value=!1;return}await B(),h.value=!1,u.value=!1,await N()}}async function N(){M();try{if(b=await q(I.test_id),!l.value){w("failure",a("Test Not Found."));return}window.onbeforeunload=function(){return!0},await oe(),v.value&&v.value.addEventListener("submit",S)}catch{w("failure",a("Error loading test data."))}finally{R()}}function Y(){window.scrollTo(0,0)}function $(){U(a("Are you sure you want to submit the test?<br>You will not be able to continue the test once it is submitted."),a("Submit"),G)}async function G(){if(v.value){const e=new FormData(v.value),n=await j(e);z(n),window.onbeforeunload=null,V.push({name:"test-report",params:{user_test_id:n.id}})}}function S(e){e.preventDefault()}return(e,n)=>{var x;return i(),o(_,null,[!t(l)&&t(g)?(i(),o("div",fe,[s("div",pe,[s("label",ve,r(t(a)("Full Name")),1),F(s("input",{type:"text",class:C([{"is-invalid":c.value.displayName},"form-control"]),id:"full-name-input","onUpdate:modelValue":n[0]||(n[0]=m=>D(p)?p.value=m:null),disabled:u.value},null,10,be),[[L,t(p)]]),c.value.displayName?(i(),o("div",_e,r(c.value.displayName),1)):f("",!0)]),s("div",he,[s("label",ye,r(t(a)("Email")),1),F(s("input",{type:"email",class:C([{"is-invalid":c.value.email},"form-control"]),id:"email-input","onUpdate:modelValue":n[1]||(n[1]=m=>D(d)?d.value=m:null),disabled:u.value},null,10,Te),[[L,t(d)]]),c.value.email?(i(),o("div",we,r(c.value.email),1)):f("",!0)]),s("button",{type:"button",onClick:O,class:"btn btn-primary",disabled:u.value},[u.value?(i(),o(_,{key:0},[T(r(t(a)("Starting"))+" ...",1)],64)):(i(),o(_,{key:1},[T(r(t(a)("Start Test")),1)],64))],8,ke)])):f("",!0),t(l)?(i(),o("div",ge,[s("div",Ne,r(t(l).name),1),t(k)>0?(i(),o("div",Se,[n[2]||(n[2]=s("i",{class:"bi bi-alarm"},null,-1)),T(" "+r(H.value),1)])):f("",!0)])):f("",!0),t(l)?(i(),o("div",xe,[s("div",{class:"test-description",innerHTML:P.value},null,8,Ee),s("div",Fe,r(t(a)("({points} pts)",{points:t(l).max_points})),1)])):f("",!0),t(l)?(i(),o("div",Le,[s("form",Ce,[(i(!0),o(_,null,ie((x=t(l))==null?void 0:x.questions,(m,J)=>(i(),le(me,{key:m.id,question:m,choices:m.choices,nbr:J+1,preview:!1},null,8,["question","choices","nbr"]))),128))],512),s("div",De,[s("button",{type:"button",class:"btn btn-outline-primary to-the-top",onClick:Y,"aria-label":t(a)("go to the top of the page")},n[3]||(n[3]=[s("i",{class:"bi bi-arrow-up"},null,-1)]),8,Ie),s("button",{type:"button",class:"btn btn-primary",onClick:$},r(t(a)("Finish The Test")),1)])])):f("",!0)],64)}}}),je=re(Ve,[["__scopeId","data-v-440f1e03"]]);export{je as default};
