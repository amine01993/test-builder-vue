import{d as Z,q as $,g as ee,u as te,B as P,r as z,c as C,h as se,i as ie,M as ae,j as ne,k as oe,_ as le,a as n,b as s,x as O,y as H,n as Q,t as y,e as d,F as g,z as _,m as re,o as a,l as de}from"./index-DgVFOuIu.js";import{u as ue}from"./userTestService-Bo-wVb0B.js";import{D as me}from"./DisplayQuestion-BDqpr6tG.js";import"./firestore-CKAN35Ge.js";import"./Question-DJVAB3JS.js";const ce=Z({__name:"TestPortalView",props:{test_id:{type:String,required:!0}},setup(E,{expose:i}){i();const k=$(),{startLoading:e,endLoading:S,showMessage:h,validateEmail:f}=ee(),{auth:o}=te(),{test:u,time_limit:I,displayName:T,email:b,requestUserInfo:L,updateUserInfo:F,initTest:U,sendReport:V,setTestReport:q}=ue(),N=P("test-submission-modal"),r=P("test-form"),w=z(!1),v=z(!1),B=C(()=>{const t={};return w.value&&(T.value===""&&(t.displayName="Full name required"),b.value===""?t.email="Email required":f(b.value)||(t.email="Invalid email")),t});let m,l=null;const Y=C(()=>{let t=I.value;const c=Math.floor(t/60/60);t=t-c*60*60;const x=Math.floor(t/60);t=t-x*60;const A=t;let p=[];return c&&p.push(c+"h"),x&&p.push(x+"min"),A&&p.push(A+"s"),p.length===0?"Time out":p.join(" ")}),G=C(()=>{var t;return(t=u.value)!=null&&t.description?u.value.description.replace(/\n/g,"<br />"):""}),R=se(o,async t=>{t&&(t.displayName&&(T.value=t.displayName),t.email&&(b.value=t.email),(T.value&&b.value||!L.value)&&await M())});ie(()=>{N.value&&(l=new ae(N.value,{backdrop:"static",keyboard:!1}))}),ne(()=>{R(),m!==void 0&&(clearInterval(m),m=void 0),l&&l.dispose(),r.value&&r.value.removeEventListener("submit",D),window.onbeforeunload=null});async function J(){if(w.value=!0,!v.value){if(v.value=!0,Object.keys(B.value).length>0){v.value=!1;return}await F(),w.value=!1,v.value=!1,await M()}}async function M(){e();try{if(m=await U(E.test_id),!u.value){h("failure","Test Not Found.");return}window.onbeforeunload=function(){return!0},await oe(),r.value&&r.value.addEventListener("submit",D)}catch{h("failure","Error loading test data.")}finally{S()}}function K(){window.scrollTo(0,0)}function W(){l&&l.show()}async function X(){if(l&&l.hide(),r.value){const t=new FormData(r.value),c=await V(t);q(c),window.onbeforeunload=null,k.push({name:"test-report",params:{user_test_id:c.id}})}}function D(t){t.preventDefault()}const j={router:k,startLoading:e,endLoading:S,showMessage:h,validateEmail:f,auth:o,test:u,time_limit:I,displayName:T,email:b,requestUserInfo:L,updateUserInfo:F,initTest:U,sendReport:V,setTestReport:q,testSubmissionEl:N,testFormEl:r,submitted:w,submitting:v,errors:B,get timeoutInterval(){return m},set timeoutInterval(t){m=t},get testSubmissionModal(){return l},set testSubmissionModal(t){l=t},timeLimit:Y,description:G,onAuthEventDispose:R,startTest:J,initializingDTest:M,moveToTheTop:K,finishTest:W,submitTest:X,preventTestSubmit:D,DisplayQuestion:me};return Object.defineProperty(j,"__isScriptSetup",{enumerable:!1,value:!0}),j}}),fe={key:0,class:"user-info-form"},be={class:"mb-3"},ve=["disabled"],pe={key:0,class:"invalid-feedback is-invalid"},ye={class:"mb-3"},_e=["disabled"],he={key:0,class:"invalid-feedback is-invalid"},Te=["disabled"],we={key:1,class:"app-test-header"},ge={class:"test-name"},ke={key:0,class:"test-limit"},Se={key:2,class:"app-test-description"},Ne=["innerHTML"],Me={class:"test-points"},De={key:3,class:"app-main"},xe={ref:"test-form"},Ce={class:"modal",tabindex:"-1",ref:"test-submission-modal"};function Ee(E,i,k,e,S,h){var f;return a(),n(g,null,[!e.test&&e.requestUserInfo?(a(),n("div",fe,[s("div",be,[i[2]||(i[2]=s("label",{for:"full-name-input",class:"form-label"},"Full Name",-1)),O(s("input",{type:"text",class:Q([{"is-invalid":e.errors.displayName},"form-control"]),id:"full-name-input","onUpdate:modelValue":i[0]||(i[0]=o=>e.displayName=o),disabled:e.submitting},null,10,ve),[[H,e.displayName]]),e.errors.displayName?(a(),n("div",pe,y(e.errors.displayName),1)):d("",!0)]),s("div",ye,[i[3]||(i[3]=s("label",{for:"email-input",class:"form-label"},"Email",-1)),O(s("input",{type:"email",class:Q([{"is-invalid":e.errors.email},"form-control"]),id:"email-input","onUpdate:modelValue":i[1]||(i[1]=o=>e.email=o),disabled:e.submitting},null,10,_e),[[H,e.email]]),e.errors.email?(a(),n("div",he,y(e.errors.email),1)):d("",!0)]),s("button",{type:"button",onClick:e.startTest,class:"btn btn-primary",disabled:e.submitting},[e.submitting?(a(),n(g,{key:0},[_("Starting ...")],64)):(a(),n(g,{key:1},[_("Start Test")],64))],8,Te)])):d("",!0),e.test?(a(),n("div",we,[s("div",ge,y(e.test.name),1),e.time_limit>0?(a(),n("div",ke,[i[4]||(i[4]=s("i",{class:"bi bi-alarm"},null,-1)),_(" "+y(e.timeLimit),1)])):d("",!0)])):d("",!0),e.test?(a(),n("div",Se,[s("div",{class:"test-description",innerHTML:e.description},null,8,Ne),s("div",Me," ("+y(e.test.max_points)+" pts) ",1)])):d("",!0),e.test?(a(),n("div",De,[s("form",xe,[(a(!0),n(g,null,re((f=e.test)==null?void 0:f.questions,(o,u)=>(a(),de(e.DisplayQuestion,{key:o.id,question:o,choices:o.choices,nbr:u+1,preview:!1},null,8,["question","choices","nbr"]))),128))],512),s("div",{class:"app-test-actions"},[s("button",{type:"button",class:"btn btn-outline-primary to-the-top",onClick:e.moveToTheTop},i[5]||(i[5]=[s("i",{class:"bi bi-arrow-up"},null,-1)])),s("button",{type:"button",class:"btn btn-primary",onClick:e.finishTest}," Finish The Test ")])])):d("",!0),s("div",Ce,[s("div",{class:"modal-dialog modal-dialog-centered"},[s("div",{class:"modal-content"},[i[7]||(i[7]=s("div",{class:"modal-body"},[s("p",null,[_(" Are you sure you want to submit the test?"),s("br"),_(" You will not be able to continue the test once it is submitted. ")])],-1)),s("div",{class:"modal-footer"},[i[6]||(i[6]=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),s("button",{type:"button",class:"btn btn-danger",onClick:e.submitTest},"Submit")])])])],512)],64)}const qe=le(ce,[["render",Ee],["__scopeId","data-v-c399cbe0"],["__file","C:/Users/erram/OneDrive/Documents/test-builder-vue/src/views/TestPortalView.vue"]]);export{qe as default};
