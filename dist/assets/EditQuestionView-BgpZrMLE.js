import{g as G,B as ee,c as H,d as O,_ as N,v as U,o as n,a as c,F as h,b as t,t as a,p as f,w as y,f as te,n as m,D as ie,q as oe,u as se,r as v,h as ne,i as ce,P as re,j as le,l as I,m as L,e as C,x as P,y as Y,J as ae,z as D}from"./index-CGS4B7OT.js";import{d as de}from"./vuedraggable.umd-BCWnW8aA.js";import{b as K,a as ue}from"./testService-DeBIOd3R.js";import{Q as J}from"./Question-DJVAB3JS.js";import{A as he}from"./AppContainer-BbQHt-u2.js";import"./firestore-B39V3hTY.js";function W(r,i,o){const{showMessage:e,startLoading:d,endLoading:_}=G(),{deleteChoice:u}=K(),{confirm:s}=ee(),k=new Date,q=H(()=>{const p=o.updated_at.toDate();return new Intl.DateTimeFormat("en-US",{day:"numeric",month:"short",year:k.getFullYear()===p.getFullYear()?void 0:"numeric",hour:"numeric",minute:"numeric"}).format(p)});function w(){o&&s(`Are you sure you want to delete this choice: "${o.text}"?`,"Delete",E)}async function E(){if(r&&i&&(o!=null&&o.id))try{d(),await u(r,i,o.id),e("success","Choice deleted with success.")}catch{e("failure","Choice can not be deleted.")}finally{_()}}return{updatedAt:q,confirmChoicedeletion:w}}const me=O({__name:"ChoiceItem",props:{test_id:{type:String,required:!1},question_id:{type:String,required:!1},choice:{type:Object,required:!1}},setup(r,{expose:i}){i();const{updatedAt:o,confirmChoicedeletion:e}=W(r.test_id,r.question_id,r.choice),d={updatedAt:o,confirmChoicedeletion:e};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}}),_e={class:"choice-item-content"},ve={class:"choice-item-title"},fe={class:"choice-item-info"},be={class:"choice-property"},ye={class:"choice-property"},pe={class:"choice-property"},ge={class:"choice-last-update"},Ce={class:"choice-item-actions"},ke={key:1,class:"choice-item-content"};function qe(r,i,o,e,d,_){const u=U("RouterLink");return n(),c("div",{class:m(["choice-item-container",{"placeholder-wave":!o.choice}])},[o.choice?(n(),c(h,{key:0},[i[5]||(i[5]=t("div",{class:"choice-item-sort-handler"},[t("i",{class:"bi bi-arrow-down-up"})],-1)),t("div",_e,[t("div",ve,a(o.choice.text),1),i[3]||(i[3]=t("hr",{class:"choice-item-divider"},null,-1)),t("div",fe,[t("div",be,"Points: "+a(o.choice.points),1),t("div",ye,"Correctness: "+a(o.choice.is_correct),1),t("div",pe,"Position: "+a(o.choice.position),1),t("div",ge,"Last updated at: "+a(e.updatedAt),1)]),i[4]||(i[4]=t("hr",{class:"choice-item-divider"},null,-1)),t("div",Ce,[f(u,{to:{name:"edit-choice",params:{test_id:o.test_id,question_id:o.question_id,choice_id:o.choice.id}},class:"btn btn-success"},{default:y(()=>i[1]||(i[1]=[t("i",{class:"bi bi-pencil-fill"},null,-1)])),_:1},8,["to"]),t("button",{type:"button",class:"btn btn-danger",onClick:i[0]||(i[0]=(...s)=>e.confirmChoicedeletion&&e.confirmChoicedeletion(...s))},i[2]||(i[2]=[t("i",{class:"bi bi-trash3-fill"},null,-1)]))])])],64)):(n(),c("div",ke,i[6]||(i[6]=[te('<div class="choice-item-title placeholder col-6 offset-3 placeholder-lg bg-secondary"></div><hr class="choice-item-divider"><div class="choice-item-info"><div class="placeholder col-12 bg-secondary" style="min-height:4em;"></div><div class="placeholder col-8 offset-4 placeholder-sm bg-secondary"></div></div><hr class="choice-item-divider"><div class="choice-item-actions placeholder col-9 offset-3 placeholder-lg bg-secondary"></div>',5)])))],2)}const we=N(me,[["render",qe],["__file","C:/Users/erram/OneDrive/Documents/test-builder-vue/src/components/items/ChoiceItem.vue"]]),Se=O({__name:"ChoiceItemD",props:{test_id:{type:String,required:!1},question_id:{type:String,required:!1},choice:{type:Object,required:!1}},setup(r,{expose:i}){i();const{updatedAt:o,confirmChoicedeletion:e}=W(r.test_id,r.question_id,r.choice),d={updatedAt:o,confirmChoicedeletion:e};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}}),xe={class:"choice-property"},De={class:"choice-property"},Ee={class:"choice-property"},Qe={class:"choice-last-update"},Ve={class:"choice-item-actions-container"},Te={class:"choice-item-actions"},Ae={key:1,colspan:"7",class:"placeholder bg-secondary"};function Fe(r,i,o,e,d,_){const u=U("RouterLink");return n(),c("tr",{class:m(["choice-item-container",{"placeholder-wave":!o.choice}])},[o.choice?(n(),c(h,{key:0},[i[3]||(i[3]=t("td",{class:"choice-item-sort-handler-container"},[t("div",{class:"choice-item-sort-handler"},[t("i",{class:"bi bi-arrow-down-up"})])],-1)),t("th",null,a(o.choice.text),1),t("td",xe,a(o.choice.points),1),t("td",De,a(o.choice.is_correct),1),t("td",Ee,a(o.choice.position),1),t("td",Qe,a(e.updatedAt),1),t("td",Ve,[t("div",Te,[f(u,{to:{name:"edit-choice",params:{test_id:o.test_id,question_id:o.question_id,choice_id:o.choice.id}},class:"btn btn-success"},{default:y(()=>i[1]||(i[1]=[t("i",{class:"bi bi-pencil-fill"},null,-1)])),_:1},8,["to"]),t("button",{type:"button",class:"btn btn-danger",onClick:i[0]||(i[0]=(...s)=>e.confirmChoicedeletion&&e.confirmChoicedeletion(...s))},i[2]||(i[2]=[t("i",{class:"bi bi-trash3-fill"},null,-1)]))])])],64)):(n(),c("td",Ae))],2)}const Ie=N(Se,[["render",Fe],["__file","C:/Users/erram/OneDrive/Documents/test-builder-vue/src/components/items/ChoiceItemD.vue"]]),Le=O({__name:"EditQuestionView",props:{test_id:{type:String,required:!0},question_id:{type:String,required:!0}},setup(r,{expose:i}){i();const o=ie(),e=oe(),{isDesktop:d,startLoading:_,endLoading:u,showMessage:s}=G(),{auth:k}=se(),{getQuestion:q,updateQuestion:w}=ue(),{choiceCount:E,choices:p,loadChoices:M,updateChoicesPositions:R}=K(),S=v(""),Q=v(J.Text),x=v(0),b=v(o.query.sF!="0"),V=v(!1),g=v(!1),T=v([]),j=H(()=>{const l={};return V.value&&(S.value===""&&(l.text="Question required"),typeof x.value=="string"&&(l.position="The position must be a number")),l}),B=ne(k,async()=>{b.value&&_();let l;try{if(l=await q(r.test_id,r.question_id),!l){s("failure","Question Not Found.");return}S.value=l.text,Q.value=l.type,x.value=l.position}catch{s("failure","Error loading question data.")}finally{b.value&&u()}try{l&&await M(r.test_id,l)}catch{s("failure","Error loading choices.")}}),A=[];ce(()=>{document.querySelectorAll(".app-main .label-info").forEach(F=>{A.push(new re(F,{container:"body",placement:"right",html:!0,trigger:"click"}))})}),le(()=>{A.forEach(l=>l.dispose()),B()});async function X(){if(!g.value){if(g.value=!0,V.value=!0,Object.keys(j.value).length>0){g.value=!1;return}try{await w(r.test_id,r.question_id,{text:S.value,type:Q.value,position:Number(x.value)}),T.value=[],s("success","Question edited with success.")}catch(l){T.value=["Server Error: "+l.code]}finally{g.value=!1}}}function Z(){b.value=!b.value,e.push({query:{sF:b.value?1:0}})}function $(){R(r.test_id,r.question_id).then(()=>{s("success","Positions updated with success.")}).catch(l=>{s("failure","Sorry! Positions can not be updated.")})}const z={route:o,router:e,isDesktop:d,startLoading:_,endLoading:u,showMessage:s,auth:k,getQuestion:q,updateQuestion:w,choiceCount:E,choices:p,loadChoices:M,updateChoicesPositions:R,text:S,type:Q,position:x,showForm:b,submitted:V,submitting:g,serverErrors:T,errors:j,onAuthEventDispose:B,popOvers:A,editQuestion:X,toggleShowForm:Z,onDragEnd:$,get draggable(){return de},get QuestionType(){return J},AppContainer:he,ChoiceItem:we,ChoiceItemD:Ie};return Object.defineProperty(z,"__isScriptSetup",{enumerable:!1,value:!0}),z}}),Pe={class:"app-main"},Oe={key:0,class:"alert alert-danger",role:"alert"},Ne={class:"mb-3"},Ue=["disabled"],Me={key:0,class:"invalid-feedback is-invalid"},Re={class:"mb-3"},je=["disabled"],Be=["value"],ze=["value"],Ye=["value"],Je=["value"],Ge={key:0,class:"invalid-feedback is-invalid"},He={class:"mb-3"},Ke=["disabled"],We={key:0,class:"invalid-feedback is-invalid"},Xe=["disabled"],Ze={class:"choice-actions"},$e={key:0,class:"choice-info"},et={key:1,class:"placeholder-wave"},tt={key:1,class:"choice-list"},it={key:2,class:"choice-list"},ot={key:1};function st(r,i,o,e,d,_){const u=U("RouterLink");return n(),I(e.AppContainer,{test_id:o.test_id},{default:y(()=>[t("div",Pe,[t("div",{class:m(["question-form",{"hide-form":!e.showForm}])},[i[9]||(i[9]=t("div",{class:"question-form-title mb-4"},"Edit Question",-1)),t("button",{class:"btn toggle-form-btn",onClick:e.toggleShowForm},[t("i",{class:m(["bi",{"bi-chevron-down":!e.showForm,"bi-chevron-up":e.showForm}])},null,2)]),e.serverErrors.length?(n(),c("div",Oe,[t("ul",null,[(n(!0),c(h,null,L(e.serverErrors,s=>(n(),c("li",{key:s},a(s),1))),128))])])):C("",!0),t("div",Ne,[i[5]||(i[5]=t("label",{for:"question-input-text",class:"form-label"},"Question",-1)),P(t("input",{type:"text",class:m(["form-control",{"is-invalid":e.errors.text}]),id:"question-input-text","onUpdate:modelValue":i[0]||(i[0]=s=>e.text=s),disabled:e.submitting},null,10,Ue),[[Y,e.text]]),e.errors.text?(n(),c("div",Me,a(e.errors.text),1)):C("",!0)]),t("div",Re,[i[6]||(i[6]=t("label",{for:"question-input-type",class:"form-label"},"Question Type",-1)),P(t("select",{class:m(["form-select",{"is-invalid":e.errors.type}]),id:"question-input-type","onUpdate:modelValue":i[1]||(i[1]=s=>e.type=s),disabled:e.submitting},[t("option",{value:e.QuestionType.Text},"Text",8,Be),t("option",{value:e.QuestionType.MultipleChoice},"Multiple Choice",8,ze),t("option",{value:e.QuestionType.Number},"Number",8,Ye),t("option",{value:e.QuestionType.SingleChoice},"Single Choice",8,Je)],10,je),[[ae,e.type]]),e.errors.type?(n(),c("div",Ge,a(e.errors.type),1)):C("",!0)]),t("div",He,[i[7]||(i[7]=t("label",{for:"question-input-position",class:"form-label"},"Position",-1)),i[8]||(i[8]=t("span",{class:"label-info","data-bs-content":"The position of the question in the test."},[t("i",{class:"bi bi-question-circle-fill"})],-1)),P(t("input",{type:"number",class:m(["form-control",{"is-invalid":e.errors.position}]),id:"question-input-position","onUpdate:modelValue":i[2]||(i[2]=s=>e.position=s),disabled:e.submitting},null,10,Ke),[[Y,e.position]]),e.errors.position?(n(),c("div",We,a(e.errors.position),1)):C("",!0)]),t("button",{type:"button",class:"btn btn-primary",onClick:e.editQuestion,disabled:e.submitting},[e.submitting?(n(),c(h,{key:1},[D("Editing ...")],64)):(n(),c(h,{key:0},[D("Edit")],64))],8,Xe)],2)]),t("div",Ze,[f(u,{to:{name:"create-choice",params:{test_id:o.test_id,question_id:o.question_id}},class:"btn btn-warning"},{default:y(()=>i[10]||(i[10]=[D("Create New Choice")])),_:1},8,["to"])]),e.choiceCount!==0?(n(),c("div",$e,[e.choiceCount?(n(),c(h,{key:0},[i[11]||(i[11]=t("span",{class:"choice-info-label"},"Total number of choices:",-1)),D(" "+a(e.choiceCount),1)],64)):(n(),c("div",et,i[12]||(i[12]=[t("div",{class:"placeholder placeholder-lg col-8 bg-secondary"},null,-1)])))])):C("",!0),e.isDesktop?(n(),c("div",it,[t("table",{class:m(["table",{loading:!e.choices}])},[i[13]||(i[13]=t("thead",null,[t("tr",null,[t("th",{scope:"col"}),t("th",{scope:"col"},"Choice"),t("th",{scope:"col"},"Points"),t("th",{scope:"col"},"Is Correct"),t("th",{scope:"col"},"Position"),t("th",{scope:"col"},"Last updated at"),t("th",{scope:"col"},"Actions")])],-1)),e.choices?(n(),I(e.draggable,{key:0,modelValue:e.choices,"onUpdate:modelValue":i[4]||(i[4]=s=>e.choices=s),"item-key":"id",tag:"tbody",handle:".choice-item-sort-handler",onEnd:e.onDragEnd},{item:y(({element:s})=>[f(e.ChoiceItemD,{test_id:o.test_id,question_id:o.question_id,choice:s},null,8,["test_id","question_id","choice"])]),_:1},8,["modelValue"])):(n(),c("tbody",ot,[(n(),c(h,null,L(5,s=>f(e.ChoiceItemD,{key:"choice-placeholder-"+s})),64))]))],2)])):(n(),c(h,{key:1},[e.choices?(n(),I(e.draggable,{key:0,modelValue:e.choices,"onUpdate:modelValue":i[3]||(i[3]=s=>e.choices=s),"item-key":"id",tag:"div","component-data":{class:"choice-list"},handle:".choice-item-sort-handler",onEnd:e.onDragEnd},{item:y(({element:s})=>[f(e.ChoiceItem,{test_id:o.test_id,question_id:o.question_id,choice:s},null,8,["test_id","question_id","choice"])]),_:1},8,["modelValue"])):(n(),c("div",tt,[(n(),c(h,null,L([0,1,2],s=>f(e.ChoiceItem,{key:"choice-placeholder-"+s})),64))]))],64))]),_:1},8,["test_id"])}const ut=N(Le,[["render",st],["__scopeId","data-v-2d7f7ac0"],["__file","C:/Users/erram/OneDrive/Documents/test-builder-vue/src/views/EditQuestionView.vue"]]);export{ut as default};
