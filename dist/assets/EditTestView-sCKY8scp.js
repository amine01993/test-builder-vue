import{d as z,g as Y,B as ee,c as P,i as G,M as te,j as H,_ as J,v as K,o as a,a as l,b as i,t as m,e as _,p as k,w as C,f as ie,C as se,q as oe,u as ne,r as b,h as ae,P as le,l as j,n as g,F as w,m as B,x as N,y as A,z as D}from"./index-DgVFOuIu.js";import{d as re}from"./vuedraggable.umd-D4hbS-nB.js";import{a as W,u as de}from"./testService-B9g0yUeR.js";import{Q as O}from"./Question-DJVAB3JS.js";import{A as ue}from"./AppContainer-B7WmBWY1.js";import"./firestore-CKAN35Ge.js";import"./Breadcrumb-0WoaLxXW.js";const ce=z({__name:"QuestionItem",props:{test_id:{type:String,required:!1},question:{type:Object,required:!1}},setup(u,{expose:t}){t();const{showMessage:s,startLoading:e,endLoading:f}=Y(),{deleteQuestion:v}=W(),r=ee("confirm-deletion-modal"),o=new Date;let c=null;const T=P(()=>{var d;switch((d=u.question)==null?void 0:d.type){case O.MultipleChoice:return"Multiple Choice";case O.Number:return"Number";case O.SingleChoice:return"Single Choice";default:return"Text"}}),L=P(()=>{const d=u.question.updated_at.toDate();return new Intl.DateTimeFormat("en-US",{day:"numeric",month:"short",year:o.getFullYear()===d.getFullYear()?void 0:"numeric",hour:"numeric",minute:"numeric"}).format(d)});G(()=>{r.value&&(c=new te(r.value))}),H(()=>{c&&c.dispose()});function x(){c&&c.show()}async function S(){var d;if(c&&c.hide(),u.test_id&&((d=u.question)!=null&&d.id))try{e(),await v(u.test_id,u.question.id),s("success","Question deleted with success.")}catch{s("failure","Question can not be deleted.")}finally{f()}}const y={showMessage:s,startLoading:e,endLoading:f,deleteQuestion:v,questionConfirmDeletionModalEl:r,currentDate:o,get questionConfirmDeletionModal(){return c},set questionConfirmDeletionModal(d){c=d},questionType:T,updatedAt:L,confirmQuestiondeletion:x,deleteDQuestion:S};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),me={key:0,class:"question-item-container"},fe={class:"question-item-content"},ve={class:"question-item-title"},be={class:"question-item-info"},qe={class:"question-property"},_e={class:"question-property"},ye={class:"question-property"},he={key:0,class:"question-property"},pe={class:"question-last-update"},ge={class:"question-item-actions"},we={class:"modal",tabindex:"-1",ref:"confirm-deletion-modal"},ke={class:"modal-dialog modal-dialog-centered"},Ce={class:"modal-content"},Te={class:"modal-body"},Se={key:1,class:"question-item-container placeholder-wave"};function Ee(u,t,s,e,f,v){const r=K("RouterLink");return s.question?(a(),l("div",me,[t[7]||(t[7]=i("div",{class:"question-item-sort-handler"},[i("i",{class:"bi bi-arrow-down-up"})],-1)),i("div",fe,[i("div",ve,m(s.question.text),1),t[3]||(t[3]=i("hr",{class:"question-item-divider"},null,-1)),i("div",be,[i("div",qe,"Max Points: "+m(s.question.max_points),1),i("div",_e,"Type: "+m(e.questionType),1),i("div",ye,"Position: "+m(s.question.position),1),s.question.choiceCount?(a(),l("div",he,"Total number of choices: "+m(s.question.choiceCount),1)):_("",!0),i("div",pe,"Last updated at: "+m(e.updatedAt),1)]),t[4]||(t[4]=i("hr",{class:"question-item-divider"},null,-1)),i("div",ge,[k(r,{to:{name:"preview-question",params:{test_id:s.test_id,question_id:s.question.id}},class:"btn btn-primary"},{default:C(()=>t[0]||(t[0]=[i("i",{class:"bi bi-eye-fill"},null,-1)])),_:1},8,["to"]),k(r,{to:{name:"edit-question",params:{test_id:s.test_id,question_id:s.question.id}},class:"btn btn-success"},{default:C(()=>t[1]||(t[1]=[i("i",{class:"bi bi-pencil-fill"},null,-1)])),_:1},8,["to"]),i("button",{type:"button",class:"btn btn-danger",onClick:e.confirmQuestiondeletion},t[2]||(t[2]=[i("i",{class:"bi bi-trash3-fill"},null,-1)]))])]),i("div",we,[i("div",ke,[i("div",Ce,[t[6]||(t[6]=i("div",{class:"modal-header"},[i("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),i("div",Te,[i("p",null,'Are you sure you want to delete this question: "'+m(s.question.text)+'"?',1)]),i("div",{class:"modal-footer"},[t[5]||(t[5]=i("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),i("button",{type:"button",class:"btn btn-danger",onClick:e.deleteDQuestion},"Delete")])])])],512)])):(a(),l("div",Se,t[8]||(t[8]=[ie('<div class="question-item-content"><div class="question-item-title placeholder col-6 offset-3 placeholder-lg bg-secondary"></div><hr class="question-item-divider"><div class="question-item-info"><div class="placeholder col-12 bg-secondary" style="min-height:4em;"></div><div class="placeholder col-8 offset-4 placeholder-sm bg-secondary"></div></div><hr class="question-item-divider"><div class="question-item-actions placeholder col-9 offset-3 placeholder-lg bg-secondary"></div></div>',1)])))}const De=J(ce,[["render",Ee],["__file","C:/Users/erram/OneDrive/Documents/test-builder-vue/src/components/items/QuestionItem.vue"]]),Le=z({__name:"EditTestView",props:{test_id:{type:String,required:!0}},setup(u,{expose:t}){t();const s=se(),e=oe(),{startLoading:f,endLoading:v,showMessage:r}=Y(),{auth:o}=ne(),{getTest:c,updateTest:T}=de(),{questionCount:L,questions:x,loadQuestions:S,updateQuestionsPositions:y}=W(),d=b(""),E=b(""),h=b(0),q=b(s.query.sF!="0"),Q=b(!1),p=b(!1),F=b([]),U=P(()=>{const n={};return Q.value&&(d.value===""&&(n.name="Name required"),typeof h.value=="string"?n.timeLimit="The time limit must be a number":h.value<0&&(n.timeLimit="The time limit can't be a negatif number")),n}),I=ae(o,async()=>{q.value&&f();let n;try{if(n=await c(u.test_id),!n){r("failure","Test Not Found.");return}d.value=n.name,E.value=n.description,h.value=n.time_limit}catch{r("failure","Error loading test data.")}finally{q.value&&v()}try{n&&await S(n)}catch{r("failure","Error loading questions.")}}),M=[];G(()=>{document.querySelectorAll(".app-main .label-info").forEach(V=>{M.push(new le(V,{container:"body",placement:"right",html:!0,trigger:"click"}))})}),H(()=>{M.forEach(n=>n.dispose()),I()});async function X(){if(!p.value){if(p.value=!0,Q.value=!0,Object.keys(U.value).length>0){p.value=!1;return}try{await T(u.test_id,{name:d.value,description:E.value,time_limit:Number(h.value)}),F.value=[],e.push({name:"tests"})}catch(n){F.value=["Server Error: "+n.code]}finally{p.value=!1}}}function Z(){q.value=!q.value,e.push({query:{sF:q.value?1:0}})}function $(){u.test_id&&y(u.test_id).then(()=>{r("success","Positions updated with success.")}).catch(n=>{r("failure","Sorry! Positions can not be updated.")})}const R={route:s,router:e,startLoading:f,endLoading:v,showMessage:r,auth:o,getTest:c,updateTest:T,questionCount:L,questions:x,loadQuestions:S,updateQuestionsPositions:y,name:d,description:E,timeLimit:h,showForm:q,submitted:Q,submitting:p,serverErrors:F,errors:U,onAuthEventDispose:I,popOvers:M,editTest:X,toggleShowForm:Z,onDragEnd:$,get draggable(){return re},QuestionItem:De,AppContainer:ue};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),xe={class:"app-main"},Qe={key:0,class:"alert alert-danger",role:"alert"},Fe={class:"mb-3"},Me=["disabled"],Ve={key:0,class:"invalid-feedback is-invalid"},Ne={class:"mb-3"},Ae=["disabled"],Oe={key:0,class:"invalid-feedback is-invalid"},Pe={class:"mb-3"},Ue=["disabled"],Ie={key:0,class:"invalid-feedback is-invalid"},Re=["disabled"],je={class:"question-actions"},Be={key:0,class:"question-info"},ze={key:1,class:"placeholder-wave"},Ye={key:2,class:"question-list"};function Ge(u,t,s,e,f,v){const r=K("RouterLink");return a(),j(e.AppContainer,null,{default:C(()=>[i("div",xe,[i("div",{class:g(["test-form",{"hide-form":!e.showForm}])},[t[8]||(t[8]=i("div",{class:"test-form-title mb-4"},"Edit Test",-1)),i("button",{class:"btn toggle-form-btn",onClick:e.toggleShowForm},[i("i",{class:g(["bi",{"bi-chevron-down":!e.showForm,"bi-chevron-up":e.showForm}])},null,2)]),e.serverErrors.length?(a(),l("div",Qe,[i("ul",null,[(a(!0),l(w,null,B(e.serverErrors,o=>(a(),l("li",{key:o},m(o),1))),128))])])):_("",!0),i("div",Fe,[t[4]||(t[4]=i("label",{for:"test-input-name",class:"form-label"},"Name",-1)),N(i("input",{type:"text",class:g(["form-control",{"is-invalid":e.errors.name}]),id:"test-input-name","onUpdate:modelValue":t[0]||(t[0]=o=>e.name=o),disabled:e.submitting},null,10,Me),[[A,e.name]]),e.errors.name?(a(),l("div",Ve,m(e.errors.name),1)):_("",!0)]),i("div",Ne,[t[5]||(t[5]=i("label",{for:"test-input-description",class:"form-label"},"Description",-1)),N(i("textarea",{class:g(["form-control",{"is-invalid":e.errors.description}]),id:"test-input-description","onUpdate:modelValue":t[1]||(t[1]=o=>e.description=o),rows:"3",disabled:e.submitting},null,10,Ae),[[A,e.description]]),e.errors.description?(a(),l("div",Oe,m(e.errors.description),1)):_("",!0)]),i("div",Pe,[t[6]||(t[6]=i("label",{for:"test-input-timelimit",class:"form-label"},"Time limit",-1)),t[7]||(t[7]=i("span",{class:"label-info","data-bs-content":"The test Time Limit is in seconds.<br>0 = no Time Limit"},[i("i",{class:"bi bi-question-circle-fill"})],-1)),N(i("input",{type:"number",class:g(["form-control",{"is-invalid":e.errors.timeLimit}]),id:"test-input-timelimit","onUpdate:modelValue":t[2]||(t[2]=o=>e.timeLimit=o),disabled:e.submitting},null,10,Ue),[[A,e.timeLimit]]),e.errors.timeLimit?(a(),l("div",Ie,m(e.errors.timeLimit),1)):_("",!0)]),i("button",{type:"button",class:"btn btn-primary",onClick:e.editTest,disabled:e.submitting},[e.submitting?(a(),l(w,{key:1},[D("Editing ...")],64)):(a(),l(w,{key:0},[D("Edit")],64))],8,Re)],2)]),i("div",je,[k(r,{to:{name:"create-question",params:{test_id:s.test_id}},class:"btn btn-warning create-question"},{default:C(()=>t[9]||(t[9]=[D("Create New Question")])),_:1},8,["to"])]),e.questionCount!==0?(a(),l("div",Be,[e.questionCount?(a(),l(w,{key:0},[t[10]||(t[10]=i("span",{class:"question-info-label"},"Total number of questions:",-1)),D(" "+m(e.questionCount),1)],64)):(a(),l("div",ze,t[11]||(t[11]=[i("div",{class:"placeholder placeholder-lg col-8 bg-secondary"},null,-1)])))])):_("",!0),e.questions?(a(),j(e.draggable,{key:1,modelValue:e.questions,"onUpdate:modelValue":t[3]||(t[3]=o=>e.questions=o),"item-key":"id",tag:"div","component-data":{class:"question-list"},handle:".question-item-sort-handler",onEnd:e.onDragEnd},{item:C(({element:o})=>[k(e.QuestionItem,{test_id:s.test_id,question:o},null,8,["test_id","question"])]),_:1},8,["modelValue"])):(a(),l("div",Ye,[(a(),l(w,null,B([0,1,2],o=>k(e.QuestionItem,{key:"question-placeholder-"+o})),64))]))]),_:1})}const et=J(Le,[["render",Ge],["__scopeId","data-v-a0982f31"],["__file","C:/Users/erram/OneDrive/Documents/test-builder-vue/src/views/EditTestView.vue"]]);export{et as default};
