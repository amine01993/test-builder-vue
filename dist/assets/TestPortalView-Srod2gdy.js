import{d as G,s as J,u as K,b as W,H as X,a as Z,I as $,r as B,x as N,o as ee,e as te,n as ie,g as se,k as a,j as i,t as r,A as R,B as P,p as j,q as d,F as y,C as S,l as ae,i as s,h as ne}from"./index-CEw6Ur-o.js";import{u as oe}from"./userTestService-De5gKojP.js";import{v as re,f as le}from"./utils-BFrGjP34.js";import{D as de}from"./DisplayQuestion-Bo3JfOln.js";import"./firestore-O8Pw084e.js";import"./Question-DJVAB3JS.js";const ue=G({__name:"TestPortalView",props:{test_id:{type:String,required:!0}},setup(D,{expose:n}){n();const h=J(),{t:e}=K(),{startLoading:T,endLoading:w,showMessage:u}=W(),{confirm:o}=X(),{auth:v}=Z(),{test:b,time_limit:x,displayName:_,email:m,requestUserInfo:C,updateUserInfo:E,initTest:F,sendReport:L,setTestReport:I}=oe(),l=$("test-form"),p=B(!1),f=B(!1),U=N(()=>{const t={};return p.value&&(_.value===""&&(t.displayName=e("Full Name required")),m.value===""?t.email=e("Email required"):re(m.value)||(t.email=e("Invalid email"))),t});let c;const H=N(()=>{let t=le(x.value);return t===""?e("Time out"):t}),O=N(()=>{var t;return(t=b.value)!=null&&t.description?b.value.description.replace(/\n/g,"<br />"):""}),V=ee(v,async t=>{t&&(t.displayName&&(_.value=t.displayName),t.email&&(m.value=t.email),(_.value&&m.value||!C.value)&&await g())});te(()=>{V(),c!==void 0&&(clearInterval(c),c=void 0),l.value&&l.value.removeEventListener("submit",k),window.onbeforeunload=null});async function z(){if(p.value=!0,!f.value){if(f.value=!0,Object.keys(U.value).length>0){f.value=!1;return}await E(),p.value=!1,f.value=!1,await g()}}async function g(){T();try{if(c=await F(D.test_id),!b.value){u("failure",e("Test Not Found."));return}window.onbeforeunload=function(){return!0},await ie(),l.value&&l.value.addEventListener("submit",k)}catch{u("failure",e("Error loading test data."))}finally{w()}}function Q(){window.scrollTo(0,0)}function Y(){o(e("Are you sure you want to submit the test?<br>You will not be able to continue the test once it is submitted."),e("Submit"),q)}async function q(){if(l.value){const t=new FormData(l.value),A=await L(t);I(A),window.onbeforeunload=null,h.push({name:"test-report",params:{user_test_id:A.id}})}}function k(t){t.preventDefault()}const M={router:h,t:e,startLoading:T,endLoading:w,showMessage:u,confirmFinish:o,auth:v,test:b,time_limit:x,displayName:_,email:m,requestUserInfo:C,updateUserInfo:E,initTest:F,sendReport:L,setTestReport:I,testFormEl:l,submitted:p,submitting:f,errors:U,get interval(){return c},set interval(t){c=t},timeLimit:H,description:O,onAuthEventDispose:V,startTest:z,initializingDTest:g,moveToTheTop:Q,finishTest:Y,submitTest:q,preventTestSubmit:k,DisplayQuestion:de};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}}),ce={key:0,class:"user-info-form"},me={class:"mb-3"},fe={for:"full-name-input",class:"form-label"},ve=["disabled"],be={key:0,class:"invalid-feedback is-invalid"},_e={class:"mb-3"},pe={for:"email-input",class:"form-label"},ye=["disabled"],he={key:0,class:"invalid-feedback is-invalid"},Te=["disabled"],we={key:1,class:"app-test-header"},ge={class:"test-name"},ke={key:0,class:"test-limit"},Ne={key:2,class:"app-test-description"},Se=["innerHTML"],De={class:"test-points"},xe={key:3,class:"app-main"},Ce={ref:"test-form"},Ee={class:"app-test-actions"},Fe=["aria-label"];function Le(D,n,h,e,T,w){var u;return s(),a(y,null,[!e.test&&e.requestUserInfo?(s(),a("div",ce,[i("div",me,[i("label",fe,r(e.t("Full Name")),1),R(i("input",{type:"text",class:j([{"is-invalid":e.errors.displayName},"form-control"]),id:"full-name-input","onUpdate:modelValue":n[0]||(n[0]=o=>e.displayName=o),disabled:e.submitting},null,10,ve),[[P,e.displayName]]),e.errors.displayName?(s(),a("div",be,r(e.errors.displayName),1)):d("",!0)]),i("div",_e,[i("label",pe,r(e.t("Email")),1),R(i("input",{type:"email",class:j([{"is-invalid":e.errors.email},"form-control"]),id:"email-input","onUpdate:modelValue":n[1]||(n[1]=o=>e.email=o),disabled:e.submitting},null,10,ye),[[P,e.email]]),e.errors.email?(s(),a("div",he,r(e.errors.email),1)):d("",!0)]),i("button",{type:"button",onClick:e.startTest,class:"btn btn-primary",disabled:e.submitting},[e.submitting?(s(),a(y,{key:0},[S(r(e.t("Starting"))+" ...",1)],64)):(s(),a(y,{key:1},[S(r(e.t("Start Test")),1)],64))],8,Te)])):d("",!0),e.test?(s(),a("div",we,[i("div",ge,r(e.test.name),1),e.time_limit>0?(s(),a("div",ke,[n[2]||(n[2]=i("i",{class:"bi bi-alarm"},null,-1)),S(" "+r(e.timeLimit),1)])):d("",!0)])):d("",!0),e.test?(s(),a("div",Ne,[i("div",{class:"test-description",innerHTML:e.description},null,8,Se),i("div",De,r(e.t("({points} pts)",{points:e.test.max_points})),1)])):d("",!0),e.test?(s(),a("div",xe,[i("form",Ce,[(s(!0),a(y,null,ae((u=e.test)==null?void 0:u.questions,(o,v)=>(s(),ne(e.DisplayQuestion,{key:o.id,question:o,choices:o.choices,nbr:v+1,preview:!1},null,8,["question","choices","nbr"]))),128))],512),i("div",Ee,[i("button",{type:"button",class:"btn btn-outline-primary to-the-top",onClick:e.moveToTheTop,"aria-label":e.t("go to the top of the page")},n[3]||(n[3]=[i("i",{class:"bi bi-arrow-up"},null,-1)]),8,Fe),i("button",{type:"button",class:"btn btn-primary",onClick:e.finishTest},r(e.t("Finish The Test")),1)])])):d("",!0)],64)}const Be=se(ue,[["render",Le],["__scopeId","data-v-c399cbe0"],["__file","C:/Users/erram/OneDrive/Documents/test-builder-vue/src/views/TestPortalView.vue"]]);export{Be as default};
